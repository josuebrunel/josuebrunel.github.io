<!doctype html><html lang=en><head><meta charset=UTF-8><title>How to Test Go Code Without a Test Framework | Welcome into my head</title><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Hugo 0.147.9"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Josué"><meta name=keywords content="golang,testing"><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css><link rel=stylesheet type=text/css media=screen href=/css/all.css><meta property="og:url" content="https://example.org/posts/how-to-test-go-code-without-a-test-framework/"><meta property="og:site_name" content="Welcome into my head"><meta property="og:title" content="How to Test Go Code Without a Test Framework"><meta property="og:description" content="In Go, testing your code doesn’t necessarily require a complex test framework. With the language’s built-in capabilities, you can write robust and maintainable tests that cover a wide range of scenarios. In this post, we’ll explore how to test Go code effectively without relying on any external test frameworks, focusing on leveraging reflection, generics, and the testing.Helper() function.
tl;dr Why?: https://go.dev/doc/faq#assertions Code: https://github.com/josuebrunel/gopkg/tree/main/assert Using Reflection for Testing (Before Go 1.18) Reflection in Go allows us to inspect the types and values of variables at runtime, enabling dynamic behavior in our tests. In the Assert function below, reflection is used to compare two values for equality:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-29T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-29T00:00:00+00:00"><meta property="article:tag" content="Golang"><meta property="article:tag" content="Testing"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to Test Go Code Without a Test Framework"><meta name=twitter:description content="In Go, testing your code doesn’t necessarily require a complex test framework. With the language’s built-in capabilities, you can write robust and maintainable tests that cover a wide range of scenarios. In this post, we’ll explore how to test Go code effectively without relying on any external test frameworks, focusing on leveraging reflection, generics, and the testing.Helper() function.
tl;dr Why?: https://go.dev/doc/faq#assertions Code: https://github.com/josuebrunel/gopkg/tree/main/assert Using Reflection for Testing (Before Go 1.18) Reflection in Go allows us to inspect the types and values of variables at runtime, enabling dynamic behavior in our tests. In the Assert function below, reflection is used to compare two values for equality:"><meta itemprop=name content="How to Test Go Code Without a Test Framework"><meta itemprop=description content="In Go, testing your code doesn’t necessarily require a complex test framework. With the language’s built-in capabilities, you can write robust and maintainable tests that cover a wide range of scenarios. In this post, we’ll explore how to test Go code effectively without relying on any external test frameworks, focusing on leveraging reflection, generics, and the testing.Helper() function.
tl;dr Why?: https://go.dev/doc/faq#assertions Code: https://github.com/josuebrunel/gopkg/tree/main/assert Using Reflection for Testing (Before Go 1.18) Reflection in Go allows us to inspect the types and values of variables at runtime, enabling dynamic behavior in our tests. In the Assert function below, reflection is used to compare two values for equality:"><meta itemprop=datePublished content="2024-08-29T00:00:00+00:00"><meta itemprop=dateModified content="2024-08-29T00:00:00+00:00"><meta itemprop=wordCount content="814"><meta itemprop=keywords content="Golang,Testing"></head><body><header><div id=titletext><h2 id=titleonly><a href=https://example.org/>Welcome into my head</a></h2></div><div id=title-social><div id=social><nav><ul><li><button id=dark-mode aria-label="Switch Dark Mode"><span title="Switch Dark Mode" class="icons fas fa-moon" aria-hidden=true></span></button></li></ul></nav></div></div><div id=mainmenu><nav><ul><li><a href=/posts/>Posts</a></li></ul></nav></div></header><main><div class=post><article><div class=post-header><div class=meta><div class=date><span class=day>29</span>
<span class=rest>Aug 2024</span></div></div><div class=matter><h1 class=title>How to Test Go Code Without a Test Framework</h1><p class=post-meta><span class=post-meta><span aria-label=Author:><span class="fas fa-user" aria-hidden=true></span></span>&nbsp;
Josué</span></p></div></div><div class=markdown><p>In Go, testing your code doesn&rsquo;t necessarily require a complex test framework. With the language&rsquo;s built-in capabilities, you can write robust and maintainable tests that cover a wide range of scenarios. In this post, we&rsquo;ll explore how to test Go code effectively without relying on any external test frameworks, focusing on leveraging reflection, generics, and the <code>testing.Helper()</code> function.</p><h2 id=tldr>tl;dr</h2><ul><li><strong>Why?</strong>: <a href=https://go.dev/doc/faq#assertions target=_blank>https://go.dev/doc/faq#assertions</a></li><li><strong>Code</strong>: <a href=https://github.com/josuebrunel/gopkg/tree/main/assert target=_blank>https://github.com/josuebrunel/gopkg/tree/main/assert</a></li></ul><h2 id=using-reflection-for-testing-before-go-118>Using Reflection for Testing (Before Go 1.18)</h2><p>Reflection in Go allows us to inspect the types and values of variables at runtime, enabling dynamic behavior in our tests. In the <code>Assert</code> function below, reflection is used to compare two values for equality:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Assert</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#66d9ef>any</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>DeepEqual</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;[ASSERT-FAILED] - %v != %v&#34;</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The <code>Assert</code> function takes two values of any type (<code>x</code> and <code>y</code>) and compares them using <code>reflect.DeepEqual</code>. This allows us to write tests that can handle various types, from primitive types like <code>int</code> and <code>string</code> to more complex structs.</p><p>However, reflection has its downsides:</p><ul><li><strong>Performance Overhead</strong>: Reflection is slower than direct type comparisons.</li><li><strong>Verbosity</strong>: Using <code>reflect.DeepEqual</code> can be less intuitive, especially for developers unfamiliar with reflection.</li></ul><h2 id=enter-generics-a-game-changer>Enter Generics: A Game Changer</h2><p>Generics, introduced in Go 1.18, offer a more type-safe and efficient way to achieve what we did with reflection, but with cleaner code and better performance. Here&rsquo;s how we can rewrite our <code>Assert</code> function using generics:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>AssertT</span>[<span style=color:#a6e22e>T</span> <span style=color:#a6e22e>comparable</span>](<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Helper</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>y</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;[ASSERT-FAILED] - %v != %v&#34;</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This version of <code>AssertT</code> is type-safe and does not incur the performance cost of reflection. The use of the <code>comparable</code> constraint ensures that the types passed to the function support equality checks (<code>==</code>), making it safer and more predictable.</p><p>The benefits of this approach include:</p><ul><li><strong>Type safety</strong>: The compiler ensures that <code>x</code> and <code>y</code> are of the same type.</li><li><strong>Performance</strong>: No reflection is needed, leading to faster execution.</li><li><strong>Clarity</strong>: The function signature clearly communicates its purpose and constraints.</li></ul><h2 id=enhancing-test-helpers-with-testinghelper>Enhancing Test Helpers with testing.Helper()</h2><p>The <code>t.Helper()</code> function is a small but powerful addition to our test helper functions. When a test fails, Go&rsquo;s testing library reports the line of code where the failure occurred. Without <code>t.Helper()</code>, this line would be inside the helper function itself, making it harder to diagnose issues.</p><p>By calling <code>t.Helper()</code> within our helper functions like <code>AssertT</code>, we tell the testing framework that this function is a helper. This way, when an assertion fails, the reported line number will point to the actual test case where the helper was called, not to the helper function&rsquo;s internal code. This significantly improves the readability and debuggability of our test failures.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestAdd</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Run</span>(<span style=color:#e6db74>&#34;intAddition&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>AssertT</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>result</span>, <span style=color:#ae81ff>5</span>) <span style=color:#75715e>// If this fails, it will point to this line, not inside AssertT</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>If this test fails, the error messages will clearly indicate the lines in <code>TestAdd</code> where the assertions failed, making debugging much more straightforward.</p><h2 id=writing-better-test-cases-with-generics>Writing Better Test Cases with Generics</h2><p>Generics not only simplify the <code>AssertT</code> function but also enable us to write more flexible and reusable test cases. Consider the following test cases for different types:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> (
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>TestCase</span>[<span style=color:#a6e22e>T</span> <span style=color:#a6e22e>comparable</span>, <span style=color:#a6e22e>V</span> <span style=color:#a6e22e>comparable</span>] <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>A</span>, <span style=color:#a6e22e>B</span> <span style=color:#a6e22e>T</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>R</span>    <span style=color:#a6e22e>V</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>User</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>ID</span>   <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Add</span>[<span style=color:#a6e22e>T</span> <span style=color:#a6e22e>constraints</span>.<span style=color:#a6e22e>Ordered</span>](<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span> <span style=color:#a6e22e>T</span>) <span style=color:#a6e22e>T</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>b</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> (
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>uu</span> = []<span style=color:#a6e22e>User</span>{
</span></span><span style=display:flex><span>		{<span style=color:#a6e22e>ID</span>: <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>Name</span>: <span style=color:#e6db74>&#34;User1&#34;</span>},
</span></span><span style=display:flex><span>		{<span style=color:#a6e22e>ID</span>: <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>Name</span>: <span style=color:#e6db74>&#34;User2&#34;</span>},
</span></span><span style=display:flex><span>		{<span style=color:#a6e22e>ID</span>: <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>Name</span>: <span style=color:#e6db74>&#34;User1&#34;</span>},
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>tcInt</span>   = []<span style=color:#a6e22e>TestCase</span>[<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>]{{<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>}, {<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>12</span>}}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>tcStr</span>   = []<span style=color:#a6e22e>TestCase</span>[<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>string</span>]{{<span style=color:#e6db74>&#34;hello&#34;</span>, <span style=color:#e6db74>&#34;world&#34;</span>, <span style=color:#e6db74>&#34;helloworld&#34;</span>}, {<span style=color:#e6db74>&#34;pocket&#34;</span>, <span style=color:#e6db74>&#34;base&#34;</span>, <span style=color:#e6db74>&#34;pocketbase&#34;</span>}}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>tcUsers</span> = []<span style=color:#a6e22e>TestCase</span>[<span style=color:#a6e22e>User</span>, <span style=color:#66d9ef>bool</span>]{
</span></span><span style=display:flex><span>		{<span style=color:#a6e22e>uu</span>[<span style=color:#ae81ff>0</span>], <span style=color:#a6e22e>uu</span>[<span style=color:#ae81ff>2</span>], <span style=color:#66d9ef>true</span>},
</span></span><span style=display:flex><span>		{<span style=color:#a6e22e>uu</span>[<span style=color:#ae81ff>1</span>], <span style=color:#a6e22e>uu</span>[<span style=color:#ae81ff>2</span>], <span style=color:#66d9ef>false</span>},
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>These test cases are used in our tests as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// int</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Run</span>(<span style=color:#e6db74>&#34;intWithAssertT&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>tc</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>tcInt</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Assert</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>A</span>, <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>B</span>), <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>R</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// string</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Run</span>(<span style=color:#e6db74>&#34;strWithAssertT&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>tc</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>tcStr</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Assert</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>A</span>, <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>B</span>), <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>R</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// users</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Run</span>(<span style=color:#e6db74>&#34;userWithAssertT&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>tc</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>tcUsers</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>AssertT</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>A</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>B</span>, <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>R</span>) <span style=color:#75715e>// direct comparison of structures (User satisfies the comparable requirement)</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>The use of generics allows us to write one set of test logic that can be applied to different types (<code>int</code>, <code>string</code>, etc.), making our tests more concise and reducing code duplication.</p><h2 id=conclusion>Conclusion</h2><p>By leveraging Go&rsquo;s standard library, generics, and testing features like <code>testing.Helper()</code>, we can create a powerful, type-safe, and efficient testing solution without relying on external frameworks. This approach not only reduces dependencies but also deepens our understanding of Go&rsquo;s capabilities.</p><p>Remember, the goal of testing is to ensure code correctness and maintainability. Whether you choose to use these techniques or a full-fledged testing framework, the most important thing is to write clear, effective tests that give you confidence in your code.</p><p>Happy testing, Gophers!</p><h2 id=resources>Resources</h2><ul><li><strong>Why?</strong>: <a href=https://go.dev/doc/faq#assertions target=_blank>https://go.dev/doc/faq#assertions</a></li><li><strong>Code</strong>: <a href=https://github.com/josuebrunel/gopkg/tree/main/assert target=_blank>https://github.com/josuebrunel/gopkg/tree/main/assert</a></li></ul></div><div class=tags><div class=taxosfloating_left><p>Tags</p></div><div class=termsfloating_right><p><a href=/tags/golang/>golang</a>
<a href=/tags/testing/>testing</a></p></div><div class=clearit></div></div></article></div></main><script src=/js/dark-mode.js></script></body></html>